<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <jenkins.model.BuildDiscarderProperty>
      <strategy class="hudson.tasks.LogRotator">
        <daysToKeep>-1</daysToKeep>
        <numToKeep>30</numToKeep>
        <artifactDaysToKeep>-1</artifactDaysToKeep>
        <artifactNumToKeep>-1</artifactNumToKeep>
      </strategy>
    </jenkins.model.BuildDiscarderProperty>
    <com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty plugin="naginator@1.17.2">
      <optOut>false</optOut>
    </com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.ChoiceParameterDefinition>
          <name>Environment</name>
          <description>Environment for running the tests.</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>Development (Dev1)</string>
              <string>Testing (Dev2)</string>
              <string>Integration (Dev3)</string>
              <string>Architecture (Dev4)</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>Sleep</name>
          <description>Optional. Wait until the application is ready. Default 600s.</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>sleep 600s</string>
              <string>sleep 300s</string>
              <string>sleep 120s</string>
              <string>sleep 60s</string>
              <string> </string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@3.3.0">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <url>http://hd-2k8-ss02:7991/scm/bcaim/katalon.git</url>
        <credentialsId>f51b3f49-b6ed-44dd-83fa-a36a5bc3b6f4</credentialsId>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>*/development</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <submoduleCfg class="list"/>
    <extensions/>
  </scm>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>/bin/bash -xe

# Wait until BIMS is fully deployed
${Sleep}

# Variables with internal and external paths
internal_dir=$PWD
external_dir=/mnt/jenkins_home/workspace
project_dir=$JOB_NAME
reports_dir=reports/chrome

# Create the reports dir if doesn&apos;t already exist
mkdir -p $internal_dir/$reports_dir

# Delete reports content from older executions
rm -rf $internal_dir/$reports_dir/

# Create settings path
mkdir -p settings
mkdir -p settings/internal

# Copy properties file to settings path
cp Resources/com.kms.katalon.execution.properties settings/internal/

# Resolve the environment
if [ &quot;${Environment}&quot; = &quot;Development (Dev1)&quot; ]; then env=1; fi
if [ &quot;${Environment}&quot; = &quot;Testing (Dev2)&quot; ]; then env=2; fi
if [ &quot;${Environment}&quot; = &quot;Integration (Dev3)&quot; ]; then env=3; fi
if [ &quot;${Environment}&quot; = &quot;Architecture (Dev4)&quot; ]; then env=4; fi

# Resolve the Test Suite
testSuite=&apos;Test Suites/Workflows/Toyota/TIMS2&apos;

# Katalon options
katalon_opts=&quot;-browserType=&apos;Chrome&apos; -retry=0 -statusDelay=15 -testSuitePath=&apos;$testSuite&apos;&quot;

# Run awesome Katalon tests
docker run --rm \
-v $external_dir/$project_dir:/katalon/katalon/source:ro \
-v $external_dir/$project_dir/$reports_dir:/katalon/katalon/report \
-e KATALON_OPTS=&quot;$katalon_opts&quot; \
--shm-size=128M \
-e DISPLAY_CONFIGURATION=1920x1080x24 \
-e ENV=$env \
-e KEY=$key \
katalonstudio/katalon:5.7.0</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <htmlpublisher.HtmlPublisher plugin="htmlpublisher@1.13">
      <reportTargets>
        <htmlpublisher.HtmlPublisherTarget>
          <reportName>HTML Report</reportName>
          <reportDir>reports/chrome</reportDir>
          <reportFiles>report.html</reportFiles>
          <alwaysLinkToLastBuild>false</alwaysLinkToLastBuild>
          <reportTitles></reportTitles>
          <keepAll>false</keepAll>
          <allowMissing>false</allowMissing>
        </htmlpublisher.HtmlPublisherTarget>
      </reportTargets>
    </htmlpublisher.HtmlPublisher>
    <hudson.tasks.junit.JUnitResultArchiver plugin="junit@1.20">
      <testResults>reports/chrome/JUnit_Report.xml</testResults>
      <keepLongStdio>false</keepLongStdio>
      <healthScaleFactor>1.0</healthScaleFactor>
      <allowEmptyResults>true</allowEmptyResults>
    </hudson.tasks.junit.JUnitResultArchiver>
    <hudson.plugins.postbuildtask.PostbuildTask plugin="postbuild-task@1.8">
      <tasks>
        <hudson.plugins.postbuildtask.TaskProperties>
          <logTexts>
            <hudson.plugins.postbuildtask.LogProperties>
              <logText>Archiving HTML reports</logText>
              <operator>AND</operator>
            </hudson.plugins.postbuildtask.LogProperties>
          </logTexts>
          <EscalateStatus>false</EscalateStatus>
          <RunIfJobSuccessful>false</RunIfJobSuccessful>
          <script># Upload results to Katalon Analytics&#xd;
java -jar ./Drivers/katalon-report-uploader-0.0.1.jar \&#xd;
--kit.server.api=https://analytics.katalon.com \&#xd;
--projectId=9373 \&#xd;
--path=&quot;reports/chrome&quot; \&#xd;
--email=jenkinsbca@gmail.com \&#xd;
--password=$pass_analytics</script>
        </hudson.plugins.postbuildtask.TaskProperties>
      </tasks>
    </hudson.plugins.postbuildtask.PostbuildTask>
  </publishers>
  <buildWrappers>
    <hudson.plugins.ansicolor.AnsiColorBuildWrapper plugin="ansicolor@0.5.0">
      <colorMapName>xterm</colorMapName>
    </hudson.plugins.ansicolor.AnsiColorBuildWrapper>
    <EnvInjectPasswordWrapper plugin="envinject@2.1.6">
      <injectGlobalPasswords>false</injectGlobalPasswords>
      <maskPasswordParameters>true</maskPasswordParameters>
      <passwordEntries>
        <EnvInjectPasswordEntry>
          <name>key</name>
          <value>{AQAAABAAAAAgP2ErhnDA3xIYRttJvVHhyhapzhTt1CNOS9eQ5k1+kgkeKhvbQLVE3qdKz3v7NHqs}</value>
        </EnvInjectPasswordEntry>
        <EnvInjectPasswordEntry>
          <name>pass_analytics</name>
          <value>{AQAAABAAAAAQkmmPNxk0VEBU1IjttnauAgVaBQ0/0K9L+KvmtWzm9GY=}</value>
        </EnvInjectPasswordEntry>
      </passwordEntries>
    </EnvInjectPasswordWrapper>
  </buildWrappers>
</project>